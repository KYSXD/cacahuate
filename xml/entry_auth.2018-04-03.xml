<process-spec>
  <process-info>
    <author>ogastorga</author>
    <date>2018-04-02</date>
    <name>Autorización de entrada de personal</name>
    <description>Este proceso es iniciado por un empleado que quiere salir temporalmente de la empresa (e.g. a comer). La autorización llega a su supervisor, quien autoriza o rechaza la salida, evento que es notificado de nuevo al empleado y finalmente a los guardias, uno de los cuales notifica que el empleado salió de la empresa.</description>
    <public>true</public>
    <start-node>employee-node</start-node>
  </process-info>
  <process>
    <node id="employee-node" class="simple">
      <auth id="requester"></auth>
      <form-array>
        <form id="exit-form">
          <input
            type="text"
            name="reason"
            required="required"
            label="Motivo del pase"
            regex="\w{3}"
          />
        </form>
      </form-array>
    </node>

    <connector from="employee-node" to="manager-node" />

    <node id="manager-node" class="decision">
      <auth id="manager">
        <filter>
          <param name="employee" type="ref">user#requester</param>
        </filter>
      </auth>

      <form-array>
        <form id="auth-form">
          <input type="radio" name="auth" required="required">
            <option value="yes">Ándale mijito, ve</option>
            <option value="no">Ni madres</option>
          </input>
        </form>
      </form-array>
    </node>

    <connector from="manager-node" to="security-node">
      <condition>#auth-form.auth=='yes'</condition>
    </connector>

    <node id="security-node" class="simple">
      <auth id="security">
        <filter>
          <param name="ou">Security</param>
        </filter>
      </auth>

      <form-array>
        <form id="confirm-form">
          <input type="checkbox" name="confirmed" />
        </form>
      </form-array>
    </node>

    <connector from="manager-node" to="noauth-node">
     <condition>#auth-form.auth=='no'</condition>
    </connector>

    <node id="noauth-node" class="end">
      <auth target="requester"></auth>
    </node>

    <connector from="seurity-node" to="end-node" />

    <node id="end-node" class="end"></node>
  </process>
</process-spec>
